== Newssniffer

Newssniffer is a project to monitor news media organisations released under the
terms of the GNU Affero General Public License v3 or any later version.  See the 
LICENSE file for more info.

It started out as "Watch Your Mouth" which detected when the BBC censored comments
from their "Have Your Say" discussion forum.  Then "Revisionista" was added that
monitored News articles and highlighted the changes.

The "Watch Your Mouth" project has become more difficult to maintain as the BBC
tweaked their rss feeds.  With the BBC making changes to the way their forums are
moderated it has become much more difficult to catch censored comments.  So, it
has been removed from this code tree for now and will be maintained separately,
though may be retired permanently.

== Requirements

* MySQL (SQLite will not work).
* Rails 1.2.3
* Drb
* Ferret
* diff-lcs gem 
* Internet connection

== Architecture

The architecture of News sniffer is rather complex, due to the requirement that 
the backend monitoring systems could be run on different machines than the web
front end.  This allows distribution of resources (it can take rather a lot of 
bandwidth to monitor so many news articles) but also allows moving the backends 
around to prevent news organisations from blocking them.

The backends have a VPN connection to the web server (which in the current
deployment is also the database server).  They talk directly to the MySQL database 
and use a Ruby Drb service to update the Ferret search index and expire the fragment
caches.

== Drb service

To get the app running (even in development mode) you must run the Drb server.  
It is designed to be run under the "drb" environment, so configure the database.yml 
for that environment too.  The port and host it listens on can be configured using 
the <tt>config/drb_service.yaml</tt> file.

Run it like this:

<tt>
$ RAILS_ENV=drb ruby script/drb_daemon
</tt>

== Backend processes

The backend processes are executed using rake tasks.  The
<tt>revisionista:get_new_articles</tt> task grabs rss feeds and finds new news 
articles to watch.  The <tt>revisionista:get_new_versions</tt> task then screen 
scrapes the news articles and checks to see if they changed.

Known bug: the <tt>RAILS_ROOT/tmp/cache/fragment_cache</tt> directory must exist
before the rake tasks will execute.

== Plans for the future

Things have been stagnating a bit but this is how I think News Sniffer/Revisionista
should develop:

* Remove the Watch Your Mouth/Have Your Say system
* Merge the Revisionista name into News Sniffer and have the whole News Sniffer system be devoted to news article watching
* Implement a REST based API for the backend systems to use, rather than the whole direct MySQL access/Drb mess.  This would handle all the db writes, Ferret updates and cache expiry - though it obviously needs to be authenticated.
* Probably do away with the result page caching.  It's messy and slow.  I'm sure the rendering and SQL can be imprlib/news_page.rboved so performance is acceptable without.
* Add NewsPage scraper versioning, so improvements can be made to the parsers without causing new revisions to be erroneously detected
* Replace the custom Ferret implementation with acts_as_ferret, or possibly even Xapian/Sphynx?
* Show exactly which parts of each line changed (currently we only show which lines)
* Highlight changes in headlines too
* User comments, so changes can be discussed by visitors
* Changes taggable by users?  Maybe this will help classify the types of changes (typo, new facts, political)
* um, more tests.